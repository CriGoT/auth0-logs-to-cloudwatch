module.exports=function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={exports:{},id:o,loaded:!1};return e[o].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="/build/",t(0)}([function(e,t,n){(function(t){"use npm";"use strict";function o(e,n){var o=e.webtaskContext,c=["AUTH0_DOMAIN","AUTH0_GLOBAL_CLIENT_ID","AUTH0_GLOBAL_CLIENT_SECRET"],l=c.filter(function(e){return!o.data[e]});return l.length?n.status(400).send({message:"Missing settings: "+l.join(", ")}):void e.webtaskContext.read("history",{},function(c,l){var u="undefined"==typeof l?null:l.checkpointId,d=new i({domain:o.data.AUTH0_DOMAIN,clientID:o.data.AUTH0_GLOBAL_CLIENT_ID,clientSecret:o.data.AUTH0_GLOBAL_CLIENT_SECRET}),p=new r.Logger({transports:[new f({logGroupName:"auth0-pushp",logStreamName:"auth0-pushp-stream",awsAccessKeyId:"AKIAI2NS6FD5W7AL2EOQ",awsSecretKey:"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",awsRegion:"us-east-1"})]});a.waterfall([function(e){d.getAccessToken(function(t){return t&&console.log("Error authenticating:",t),e(t)})},function(e){var n=function n(o){console.log("Downloading logs from: "+(o.checkpointId||"Start")+"."),o.logs=o.logs||[],d.getLogs({take:200,from:o.checkpointId},function(r,i){return r?e(r):i&&i.length?(i.forEach(function(e){return o.logs.push(e)}),o.checkpointId=o.logs[o.logs.length-1]._id,t(function(){return n(o)})):(console.log("Total logs: "+o.logs.length+"."),e(null,o))})};n({checkpointId:u})},function(e,t){var n=parseInt(o.data.LOG_LEVEL)||0,r=function(e){return!h[e.type]||h[e.type].level>=n},i=o.data.LOG_TYPES&&o.data.LOG_TYPES.split(",")||[],a=function(e){return!i||!i.length||e.type&&i.indexOf(e.type)>=0};e.logs=e.logs.filter(function(e){return"sapi"!==e.type&&"fapi"!==e.type}).filter(r).filter(a),console.log("Filtered logs on log level '"+n+"': "+e.logs.length+"."),o.data.LOG_TYPES&&console.log("Filtered logs on '"+o.data.LOG_TYPES+"': "+e.logs.length+"."),t(null,e)},function(e,t){console.log("Uploading blobs..."),a.eachLimit(e.logs,5,function(e,t){var n=s(e.date),o=n.format("YYYY/MM/DD")+"/"+n.format("HH")+"/"+e._id+".json";console.log("Uploading "+o+"."),p.info(JSON.stringify(e),t)},function(n){return n?t(n):(console.log("Upload complete."),t(null,e))})}],function(t,o){return t?(console.log("Job failed."),e.webtaskContext.write("history",JSON.stringify({checkpointId:u}),{},function(e){return e?n.status(500).send(e):void n.status(500).send({error:t})})):(console.log("Job complete."),e.webtaskContext.write("history",JSON.stringify({checkpointId:o.checkpointId,totalLogsProcessed:o.logs.length}),{},function(e){return e?n.status(500).send(e):void n.sendStatus(200)}))})})}var r=n(4),i=n(5),a=n(6),s=n(7),c=(n(8),n(9)),l=n(10),u=c(),f=n(21),h={s:{event:"Success Login",level:1},seacft:{event:"Success Exchange",level:1},feacft:{event:"Failed Exchange",level:3},f:{event:"Failed Login",level:3},w:{event:"Warnings During Login",level:2},du:{event:"Deleted User",level:1},fu:{event:"Failed Login (invalid email/username)",level:3},fp:{event:"Failed Login (wrong password)",level:3},fc:{event:"Failed by Connector",level:3},fco:{event:"Failed by CORS",level:3},con:{event:"Connector Online",level:1},coff:{event:"Connector Offline",level:3},fcpro:{event:"Failed Connector Provisioning",level:4},ss:{event:"Success Signup",level:1},fs:{event:"Failed Signup",level:3},cs:{event:"Code Sent",level:0},cls:{event:"Code/Link Sent",level:0},sv:{event:"Success Verification Email",level:0},fv:{event:"Failed Verification Email",level:0},scp:{event:"Success Change Password",level:1},fcp:{event:"Failed Change Password",level:3},sce:{event:"Success Change Email",level:1},fce:{event:"Failed Change Email",level:3},scu:{event:"Success Change Username",level:1},fcu:{event:"Failed Change Username",level:3},scpn:{event:"Success Change Phone Number",level:1},fcpn:{event:"Failed Change Phone Number",level:3},svr:{event:"Success Verification Email Request",level:0},fvr:{event:"Failed Verification Email Request",level:3},scpr:{event:"Success Change Password Request",level:0},fcpr:{event:"Failed Change Password Request",level:3},fn:{event:"Failed Sending Notification",level:3},sapi:{event:"API Operation"},fapi:{event:"Failed API Operation"},limit_wc:{event:"Blocked Account",level:4},limit_ui:{event:"Too Many Calls to /userinfo",level:4},api_limit:{event:"Rate Limit On API",level:4},sdu:{event:"Successful User Deletion",level:1},fdu:{event:"Failed User Deletion",level:3}};u.get("/",o),u.post("/",o),e.exports=l.fromExpress(u)}).call(t,n(1).setImmediate)},function(e,t,n){function o(e,t){this._id=e,this._clearFn=t}var r=Function.prototype.apply;t.setTimeout=function(){return new o(r.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new o(r.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},n(2),t.setImmediate=setImmediate,t.clearImmediate=clearImmediate},function(e,t,n){(function(e,t){!function(e,n){"use strict";function o(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var o={callback:e,args:t};return g[p]=o,d(p),p++}function r(e){delete g[e]}function i(e){var t=e.callback,o=e.args;switch(o.length){case 0:t();break;case 1:t(o[0]);break;case 2:t(o[0],o[1]);break;case 3:t(o[0],o[1],o[2]);break;default:t.apply(n,o)}}function a(e){if(m)setTimeout(a,0,e);else{var t=g[e];if(t){m=!0;try{i(t)}finally{r(e),m=!1}}}}function s(){d=function(e){t.nextTick(function(){a(e)})}}function c(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}function l(){var t="setImmediate$"+Math.random()+"$",n=function(n){n.source===e&&"string"==typeof n.data&&0===n.data.indexOf(t)&&a(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",n,!1):e.attachEvent("onmessage",n),d=function(n){e.postMessage(t+n,"*")}}function u(){var e=new MessageChannel;e.port1.onmessage=function(e){var t=e.data;a(t)},d=function(t){e.port2.postMessage(t)}}function f(){var e=y.documentElement;d=function(t){var n=y.createElement("script");n.onreadystatechange=function(){a(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}function h(){d=function(e){setTimeout(a,0,e)}}if(!e.setImmediate){var d,p=1,g={},m=!1,y=e.document,v=Object.getPrototypeOf&&Object.getPrototypeOf(e);v=v&&v.setTimeout?v:e,"[object process]"==={}.toString.call(e.process)?s():c()?l():e.MessageChannel?u():y&&"onreadystatechange"in y.createElement("script")?f():h(),v.setImmediate=o,v.clearImmediate=r}}("undefined"==typeof self?"undefined"==typeof e?this:e:self)}).call(t,function(){return this}(),n(3))},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function r(e){if(u===setTimeout)return setTimeout(e,0);if((u===n||!u)&&setTimeout)return u=setTimeout,setTimeout(e,0);try{return u(e,0)}catch(t){try{return u.call(null,e,0)}catch(t){return u.call(this,e,0)}}}function i(e){if(f===clearTimeout)return clearTimeout(e);if((f===o||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(e);try{return f(e)}catch(t){try{return f.call(null,e)}catch(t){return f.call(this,e)}}}function a(){g&&d&&(g=!1,d.length?p=d.concat(p):m=-1,p.length&&s())}function s(){if(!g){var e=r(a);g=!0;for(var t=p.length;t;){for(d=p,p=[];++m<t;)d&&d[m].run();m=-1,t=p.length}d=null,g=!1,i(e)}}function c(e,t){this.fun=e,this.array=t}function l(){}var u,f,h=e.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:n}catch(e){u=n}try{f="function"==typeof clearTimeout?clearTimeout:o}catch(e){f=o}}();var d,p=[],g=!1,m=-1;h.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];p.push(new c(e,t)),1!==p.length||g||r(s)},c.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=l,h.addListener=l,h.once=l,h.off=l,h.removeListener=l,h.removeAllListeners=l,h.emit=l,h.binding=function(e){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(e){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(e,t){e.exports=require("winston")},function(e,t){e.exports=require("auth0@0.8.2")},function(e,t){e.exports=require("async")},function(e,t){e.exports=require("moment")},function(e,t){e.exports=require("useragent")},function(e,t){e.exports=require("express")},function(e,t,n){function o(e){return e.auth0=function(n){return t.auth0(e,n)},e}function r(e){return o(function(t,n,o){var r=s(n.x_wt.jtn);return n.originalUrl=n.url,n.url=n.url.replace(r,"/"),n.webtaskContext=c(t),e(n,o)})}function i(e){var t;return e.ext("onRequest",function(e,n){var o=s(e.x_wt.jtn);e.setUrl(e.url.replace(o,"/")),e.webtaskContext=t}),o(function(n,o,r){var i=e._dispatch();t=c(n),i(o,r)})}function a(e){return o(function(t,n,o){var r=s(n.x_wt.jtn);return n.originalUrl=n.url,n.url=n.url.replace(r,"/"),n.webtaskContext=c(t),e.emit("request",n,o)})}function s(e){var t="^/api/run/[^/]+/",n="(?:[^/?#]*/?)?";return new RegExp(t+(e?n:""))}function c(e){function t(e,t,o){var r=n(19);"function"==typeof t&&(o=t,t={}),o(r.preconditionFailed("Storage is not available in this context"))}function o(t,o,r){var i=n(19),a=n(20);"function"==typeof o&&(r=o,o={}),a({uri:e.secrets.EXT_STORAGE_URL,method:"GET",headers:o.headers||{},qs:{path:t},json:!0},function(e,t,n){return e?r(i.wrap(e,502)):404===t.statusCode&&Object.hasOwnProperty.call(o,"defaultValue")?r(null,o.defaultValue):t.statusCode>=400?r(i.create(t.statusCode,n&&n.message)):void r(null,n)})}function r(e,t,o,r){var i=n(19);"function"==typeof o&&(r=o,o={}),r(i.preconditionFailed("Storage is not available in this context"))}function i(t,o,r,i){var a=n(19),s=n(20);"function"==typeof r&&(i=r,r={}),s({uri:e.secrets.EXT_STORAGE_URL,method:"PUT",headers:r.headers||{},qs:{path:t},body:o},function(e,t,n){return e?i(a.wrap(e,502)):t.statusCode>=400?i(a.create(t.statusCode,n&&n.message)):void i(null)})}return e.read=e.secrets.EXT_STORAGE_URL?o:t,e.write=e.secrets.EXT_STORAGE_URL?i:r,e}t.auth0=n(11),t.fromConnect=t.fromExpress=r,t.fromHapi=i,t.fromServer=t.fromRestify=a},function(e,t,n){function o(e,t){return function(n,o,i){if(!o.x_wt.jtn||!o.x_wt.container)return s({code:400,message:"Auth0 authentication can only be used with named webtasks."},i);var a=r(o);if(!a)return s({code:400,message:"Error processing request URL path."},i);switch("GET"===o.method&&a.appPath){case"/login":l(t,n,o,i,a);break;case"/callback":u(t,n,o,i,a);break;default:c(e,t,n,o,i,a)}}}function r(e){var t=a.parse(e.url,!0),n=t.pathname.split("/");if("api"===n[1]&&"run"===n[2]&&n[3]===e.x_wt.container&&n[4]===e.x_wt.jtn)t.basePath=n.splice(0,5).join("/");else{if(n[1]!==e.x_wt.container||n[2]!==e.x_wt.jtn)return null;t.basePath=n.splice(0,3).join("/")}return t.appPath="/"+n.join("/"),t.baseUrl=[e.headers["x-forwarded-proto"]||"https","://",e.headers.host,t.basePath].join(""),t}function i(e){return f.replace("##",e)}var a=n(12),s=n(13),c=n(14),l=n(16),u=n(17);e.exports=function(e,t){if("function"!=typeof e||3!==e.length)throw new Error("The auth0() function can only be called on webtask functions with the (ctx, req, res) signature.");if(t||(t={}),"object"!=typeof t)throw new Error("The options parameter must be an object.");if(t.scope&&"string"!=typeof t.scope)throw new Error("The scope option, if specified, must be a string.");if(t.authorized&&["string","function"].indexOf(typeof t.authorized)<0&&!Array.isArray(t.authorized))throw new Error("The authorized option, if specified, must be a string or array of strings with e-mail or domain names, or a function that accepts (ctx, req) and returns boolean.");if(t.exclude&&["string","function"].indexOf(typeof t.exclude)<0&&!Array.isArray(t.exclude))throw new Error("The exclude option, if specified, must be a string or array of strings with URL paths that do not require authentication, or a function that accepts (ctx, req, appPath) and returns boolean.");if(t.clientId&&"function"!=typeof t.clientId)throw new Error("The clientId option, if specified, must be a function that accepts (ctx, req) and returns an Auth0 Client ID.");if(t.clientSecret&&"function"!=typeof t.clientSecret)throw new Error("The clientSecret option, if specified, must be a function that accepts (ctx, req) and returns an Auth0 Client Secret.");if(t.domain&&"function"!=typeof t.domain)throw new Error("The domain option, if specified, must be a function that accepts (ctx, req) and returns an Auth0 Domain.");if(t.webtaskSecret&&"function"!=typeof t.webtaskSecret)throw new Error("The webtaskSecret option, if specified, must be a function that accepts (ctx, req) and returns a key to be used to sign issued JWT tokens.");if(t.getApiKey&&"function"!=typeof t.getApiKey)throw new Error("The getApiKey option, if specified, must be a function that accepts (ctx, req) and returns an apiKey associated with the request.");if(t.loginSuccess&&"function"!=typeof t.loginSuccess)throw new Error("The loginSuccess option, if specified, must be a function that accepts (ctx, req, res, baseUrl) and generates a response.");if(t.loginError&&"function"!=typeof t.loginError)throw new Error("The loginError option, if specified, must be a function that accepts (error, ctx, req, res, baseUrl) and generates a response.");if(t.clientId=t.clientId||function(e,t){return e.secrets.AUTH0_CLIENT_ID},t.clientSecret=t.clientSecret||function(e,t){return e.secrets.AUTH0_CLIENT_SECRET},t.domain=t.domain||function(e,t){return e.secrets.AUTH0_DOMAIN},t.webtaskSecret=t.webtaskSecret||function(e,t){return e.secrets.WEBTASK_SECRET||t.x_wt.token},t.getApiKey=t.getApiKey||function(e,t){return t.headers.authorization&&"Bearer"===t.headers.authorization.split(" ")[0]?t.headers.authorization.split(" ")[1]:t.query&&t.query.apiKey?t.query.apiKey:null},t.loginSuccess=t.loginSuccess||function(e,t,n,o){return n.writeHead(302,{Location:o+"?apiKey="+e.apiKey}),n.end()},t.loginError=t.loginError||function(e,t,n,o,r){return"GET"===n.method?e.redirect?(o.writeHead(302,{Location:e.redirect}),o.end(JSON.stringify(e))):(o.writeHead(e.code||401,{"Content-Type":"text/html","Cache-Control":"no-cache"}),o.end(i(r+"/login"))):e(e,o)},"string"==typeof t.authorized&&(t.authorized=[t.authorized]),Array.isArray(t.authorized)){var n=[];t.authorized.forEach(function(e){n.push(e.toLowerCase())}),t.authorized=function(e,t){if(e.user.email_verified)for(var o=0;o<n.length;o++){var r=e.user.email.toLowerCase();if(r===n[o]||"@"===n[o][0]&&r.indexOf(n[o])>1)return!0}return!1}}if("string"==typeof t.exclude&&(t.exclude=[t.exclude]),Array.isArray(t.exclude)){var r=t.exclude;t.exclude=function(e,t,n){return r.indexOf(n)>-1}}return o(e,t)};var f=function(){}.toString().match(/[^]*\/\*([^]*)\*\/\s*\}$/)[1]},function(e,t){e.exports=require("url")},function(e,t){e.exports=function(e,t){t.writeHead(e.code||500,{"Content-Type":"application/json","Cache-Control":"no-cache"}),t.end(JSON.stringify(e))}},function(e,t,n){var o=n(13);e.exports=function(e,t,r,i,a,s){function c(){var e=t.getApiKey(r,i);if(!e)return t.loginError({code:401,message:"Unauthorized.",error:"Missing apiKey.",redirect:s.baseUrl+"/login"},r,i,a,s.baseUrl);var c=t.webtaskSecret(r,i);if(!c)return o({code:400,message:"The webtask secret must be provided to allow for validating apiKeys."},a);try{r.user=i.user=n(15).verify(e,c)}catch(e){return t.loginError({code:401,message:"Unauthorized.",error:e.message},r,i,a,s.baseUrl)}return r.apiKey=e,t.authorized&&!t.authorized(r,i)?t.loginError({code:403,message:"Forbidden."},r,i,a,s.baseUrl):l()}function l(){return e(r,i,a)}return t.exclude&&t.exclude(r,i,s.appPath)?l():c()}},function(e,t){e.exports=require("jsonwebtoken")},function(e,t,n){var o=n(13);e.exports=function(e,t,n,r,i){var a={clientId:e.clientId(t,n),domain:e.domain(t,n)},s=!!a.clientId+!!a.domain,c="openid name email email_verified "+(e.scope||"");if(0===s)return o({code:501,message:"Not implemented."},r);if(2===s){var l="https://"+a.domain+"/authorize?response_type=code&scope="+encodeURIComponent(c)+"&client_id="+encodeURIComponent(a.clientId)+"&redirect_uri="+encodeURIComponent(i.baseUrl+"/callback");return r.writeHead(302,{Location:l}),r.end()}return o({code:400,message:"Both or neither Auth0 Client ID and Auth0 domain must be specified."},r)}},function(e,t,n){var o=n(13);e.exports=function(e,t,r,i,a){function s(s){var c,l=n(15);try{c=l.decode(s)}catch(n){return e.loginError({code:502,message:"Cannot parse id_token returned from Auth0.",id_token:s,error:n.message},t,r,i,a.baseUrl)}var u=e.webtaskSecret(t,r);return u?(c.iss=a.baseUrl,r.user=t.user=c,t.apiKey=l.sign(c,u),e.loginSuccess(t,r,i,a.baseUrl)):o({code:400,message:"The webtask secret must be be provided to allow for issuing apiKeys."},i)}if(!t.query.code)return e.loginError({code:401,message:"Authentication error.",callbackQuery:t.query},t,r,i,a.baseUrl);var c={clientId:e.clientId(t,r),domain:e.domain(t,r),clientSecret:e.clientSecret(t,r)},l=!!c.clientId+!!c.domain+!!c.clientSecret;return 3!==l?o({code:400,message:"Auth0 Client ID, Client Secret, and Auth0 Domain must be specified."},i):n(18).post("https://"+c.domain+"/oauth/token").type("form").send({client_id:c.clientId,client_secret:c.clientSecret,redirect_uri:a.baseUrl+"/callback",code:t.query.code,grant_type:"authorization_code"}).timeout(15e3).end(function(n,o){return n||!o.ok?e.loginError({code:502,message:"OAuth code exchange completed with error.",error:n&&n.message,auth0Status:o&&o.status,auth0Response:o&&(o.body||o.text)},t,r,i,a.baseUrl):s(o.body.id_token)})}},function(e,t){e.exports=require("superagent")},function(e,t){e.exports=require("boom")},function(e,t){e.exports=require("request")},function(e,t,n){var o=n(22),r=n(23),i=n(24),a=n(4),s=n(25),c=n(26),l={EVENT_SIZE:256e3,BATCH_SIZE:1e6},u=function(e){var t=this;this.name=r.capitalize(e.name||"cloudwatch_"+e.logGroupName+"_"+e.logStreamName),this.level=e.level||"debug",this.logGroupName=e.logGroupName,this.logStreamName=e.logStreamName,this.jsonMessage=e.jsonMessage,this.cloudWatchLogs=null,e.awsAccessKeyId&&e.awsSecretKey&&e.awsRegion?this.cloudWatchLogs=new o.CloudWatchLogs({accessKeyId:e.awsAccessKeyId,secretAccessKey:e.awsSecretKey,region:e.awsRegion}):!e.awsRegion||e.awsAccessKeyId||e.awsSecretKey?this.cloudWatchLogs=new o.CloudWatchLogs:this.cloudWatchLogs=new o.CloudWatchLogs({region:e.awsRegion});var n=[];this.add=function(e){var t=s.stringify(e).length;if(t>l.EVENT_SIZE)return void console.warn("Rejecting message, message is to over the EVENT_SIZE Limit");var o={messages:[],size:0,locked:!1};0==n.length||n[n.length-1].size+t>l.BATCH_SIZE||n[n.length-1].locked?n.push(o):o=n[n.length-1],o.size=o.size+t,o.messages.push(e),n.length>254&&(n.shift(),n=r.takeRight(n,128),console.warn("Payload queue too large, cutting in half!"))};var i=function(e){function n(o){var i={logStreamNamePrefix:t.logStreamName,logGroupName:t.logGroupName};o&&(i.nextToken=o),t.cloudWatchLogs.describeLogStreams(i,function(o,i){if(o)return e(o);var a=r.find(i.logStreams,function(e){return e.logStreamName===t.logStreamName});return a?e(null,a):i.nextToken?void n(i.nextToken):(console.warn("Log group and / or log stream do not exist.  Createing stream [Log group: "+t.logGroupName+"; Log Stream : "+t.logStreamName+"]"),t.cloudWatchLogs.createLogGroup({logGroupName:t.logGroupName},function(e,n){e&&"ResourceAlreadyExistsException"!=e.code?console.warn(e,e.stack):t.cloudWatchLogs.createLogStream({logGroupName:t.logGroupName,logStreamName:t.logStreamName},function(e,t){e&&console.warn(e,e.stack)})}),e(new Error("LogGroup and/or LogStream does not exist.")))})}n()},a=function(e){i(function(t,n){return t?e(t):e(null,n.uploadSequenceToken)})},u=function(e,n){a(function(o,r){if(o)n(o);else{var i={logGroupName:t.logGroupName,logStreamName:t.logStreamName,logEvents:e.messages};r&&(i.sequenceToken=r),t.cloudWatchLogs.putLogEvents(i,function(e,t){return n(e)})}})},f=c.fibonacci({randomisationFactor:.8675309,initialDelay:100,maxDelay:1e4});f.on("ready",function(e,t){n.length>0?(n[0].locked||(n[0].locked=!0),u(n[0],function(t){t&&t.code?("ThrottlingException"!=t.code&&"InvalidSequenceTokenException"!=t.code&&"ResourceNotFoundException"!=t.code&&"OperationAbortedException"!=t.code&&console.log(t.stack||t),"ResourceNotFoundException"==t.code&&0==e&&console.error("LogGroup and/or LogStream does not exist."),f.backoff()):(n.shift(),f.reset(),f.backoff())})):(f.reset(),f.backoff())}),f.backoff()};i.inherits(u,a.Transport),u.prototype.log=function(e,t,n,o){var r={level:e,msg:t,meta:n};this.add({message:s.stringify(r,null,"  "),timestamp:Date.now()}),o(null,!0)},e.exports=u},function(e,t){e.exports=require("aws-sdk")},function(e,t){e.exports=require(void 0)},function(e,t){e.exports=require("util")},function(e,t){function n(e,t,n){var o,r=[],i=[e],a=[e],s=[n?u:"[Circular]"],c=e,l=1;return function(e,p){return t&&(p=t.call(this,e,p)),""!==e&&(c!==this&&(o=l-m.call(i,this)-1,l-=o,i.splice(l,i.length),r.splice(l-1,r.length),c=this),"object"==typeof p&&p?(m.call(i,p)<0&&i.push(c=p),l=i.length,o=m.call(a,p),o<0?(o=a.push(p)-1,n?(r.push((""+e).replace(d,f)),s[o]=u+r.join(u)):s[o]=s[0]):p=s[o]):"string"==typeof p&&n&&(p=p.replace(f,h).replace(u,f))),p}}function o(e,t){for(var n=0,o=t.length;n<o;e=e[t[n++].replace(p,u)]);return e}function r(e){return function(t,n){var o="string"==typeof n;return o&&n.charAt(0)===u?new y(n.slice(1)):(""===t&&(n=s(n,n,{})),o&&(n=n.replace(g,"$1"+u).replace(h,f)),e?e.call(this,t,n):n)}}function i(e,t,n){for(var o=0,r=t.length;o<r;o++)t[o]=s(e,t[o],n);return t}function a(e,t,n){for(var o in t)t.hasOwnProperty(o)&&(t[o]=s(e,t[o],n));return t}function s(e,t,n){return t instanceof Array?i(e,t,n):t instanceof y?t.length?n.hasOwnProperty(t)?n[t]:n[t]=o(e,t.split(u)):e:t instanceof Object?a(e,t,n):t}function c(e,t,o,r){return JSON.stringify(e,n(e,t,!r),o)}function l(e,t){return JSON.parse(e,r(t))}/*!
	Copyright (C) 2013 by WebReflection
	
	Permission is hereby granted, free of charge, to any person obtaining a copy
	of this software and associated documentation files (the "Software"), to deal
	in the Software without restriction, including without limitation the rights
	to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
	copies of the Software, and to permit persons to whom the Software is
	furnished to do so, subject to the following conditions:
	
	The above copyright notice and this permission notice shall be included in
	all copies or substantial portions of the Software.
	
	THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
	IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
	FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
	AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
	LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
	OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
	THE SOFTWARE.
	
	*/
var u="~",f="\\x"+("0"+u.charCodeAt(0).toString(16)).slice(-2),h="\\"+f,d=new RegExp(f,"g"),p=new RegExp(h,"g"),g=new RegExp("(?:^|([^\\\\]))"+h),m=[].indexOf||function(e){for(var t=this.length;t--&&this[t]!==e;);return t},y=String;this.stringify=c,this.parse=l},function(e,t,n){var o=n(27),r=n(32),i=n(34),a=n(35);e.exports.Backoff=o,e.exports.FunctionCall=a,e.exports.FibonacciStrategy=i,e.exports.ExponentialStrategy=r,e.exports.fibonacci=function(e){return new o(new i(e))},e.exports.exponential=function(e){return new o(new r(e))},e.exports.call=function(e,t,n){var o=Array.prototype.slice.call(arguments);return e=o[0],t=o.slice(1,o.length-1),n=o[o.length-1],new a(e,t,n)}},function(e,t,n){function o(e){r.EventEmitter.call(this),this.backoffStrategy_=e,this.maxNumberOfRetry_=-1,this.backoffNumber_=0,this.backoffDelay_=0,this.timeoutID_=-1,this.handlers={backoff:this.onBackoff_.bind(this)}}var r=n(28),i=n(29),a=n(24);a.inherits(o,r.EventEmitter),o.prototype.failAfter=function(e){i.checkArgument(e>0,"Expected a maximum number of retry greater than 0 but got %s.",e),this.maxNumberOfRetry_=e},o.prototype.backoff=function(e){i.checkState(this.timeoutID_===-1,"Backoff in progress."),this.backoffNumber_===this.maxNumberOfRetry_?(this.emit("fail",e),this.reset()):(this.backoffDelay_=this.backoffStrategy_.next(),this.timeoutID_=setTimeout(this.handlers.backoff,this.backoffDelay_),this.emit("backoff",this.backoffNumber_,this.backoffDelay_,e))},o.prototype.onBackoff_=function(){this.timeoutID_=-1,this.emit("ready",this.backoffNumber_,this.backoffDelay_),this.backoffNumber_++},o.prototype.reset=function(){this.backoffNumber_=0,this.backoffStrategy_.reset(),clearTimeout(this.timeoutID_),this.timeoutID_=-1},e.exports=o},function(e,t){e.exports=require("events")},function(e,t,n){e.exports=n(30)},function(e,t,n){function o(e,t,n,o){n=n||"";var r=c.format.apply(this,[n].concat(o)),i=new e(r);throw Error.captureStackTrace(i,t),i}function r(e,t,n){o(l.IllegalArgumentError,e,t,n)}function i(e,t,n){o(l.IllegalStateError,e,t,n)}function a(e){var t=typeof e;if("object"==t){if(!e)return"null";if(e instanceof Array)return"array"}return t}function s(e){return function(t,n){var o=a(t);return o==e?t:void r(arguments.callee,n||'Expected "'+e+'" but got "'+o+'".',Array.prototype.slice.call(arguments,2))}}var c=n(24),l=e.exports=n(31);e.exports.checkArgument=function(e,t){e||r(arguments.callee,t,Array.prototype.slice.call(arguments,2))},e.exports.checkState=function(e,t){e||i(arguments.callee,t,Array.prototype.slice.call(arguments,2))},e.exports.checkIsDef=function(e,t){return void 0!==e?e:void r(arguments.callee,t||"Expected value to be defined but was undefined.",Array.prototype.slice.call(arguments,2))},e.exports.checkIsDefAndNotNull=function(e,t){return null!=e?e:void r(arguments.callee,t||'Expected value to be defined and not null but got "'+a(e)+'".',Array.prototype.slice.call(arguments,2))},e.exports.checkIsString=s("string"),e.exports.checkIsArray=s("array"),e.exports.checkIsNumber=s("number"),e.exports.checkIsBoolean=s("boolean"),e.exports.checkIsFunction=s("function"),e.exports.checkIsObject=s("object")},function(e,t,n){function o(e){Error.call(this,e),this.message=e}function r(e){Error.call(this,e),this.message=e}var i=n(24);i.inherits(o,Error),o.prototype.name="IllegalArgumentError",i.inherits(r,Error),r.prototype.name="IllegalStateError",e.exports.IllegalStateError=r,e.exports.IllegalArgumentError=o},function(e,t,n){function o(e){a.call(this,e),this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay(),this.factor_=o.DEFAULT_FACTOR,e&&void 0!==e.factor&&(i.checkArgument(e.factor>1,"Exponential factor should be greater than 1 but got %s.",e.factor),this.factor_=e.factor)}var r=n(24),i=n(29),a=n(33);r.inherits(o,a),o.DEFAULT_FACTOR=2,o.prototype.next_=function(){return this.backoffDelay_=Math.min(this.nextBackoffDelay_,this.getMaxDelay()),this.nextBackoffDelay_=this.backoffDelay_*this.factor_,this.backoffDelay_},o.prototype.reset_=function(){this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay()},e.exports=o},function(e,t,n){function o(e){return void 0!==e&&null!==e}function r(e){if(e=e||{},o(e.initialDelay)&&e.initialDelay<1)throw new Error("The initial timeout must be greater than 0.");if(o(e.maxDelay)&&e.maxDelay<1)throw new Error("The maximal timeout must be greater than 0.");if(this.initialDelay_=e.initialDelay||100,this.maxDelay_=e.maxDelay||1e4,this.maxDelay_<=this.initialDelay_)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");if(o(e.randomisationFactor)&&(e.randomisationFactor<0||e.randomisationFactor>1))throw new Error("The randomisation factor must be between 0 and 1.");this.randomisationFactor_=e.randomisationFactor||0}n(28),n(24);r.prototype.getMaxDelay=function(){return this.maxDelay_},r.prototype.getInitialDelay=function(){return this.initialDelay_},r.prototype.next=function(){var e=this.next_(),t=1+Math.random()*this.randomisationFactor_,n=Math.round(e*t);return n},r.prototype.next_=function(){throw new Error("BackoffStrategy.next_() unimplemented.")},r.prototype.reset=function(){this.reset_()},r.prototype.reset_=function(){throw new Error("BackoffStrategy.reset_() unimplemented.")},e.exports=r},function(e,t,n){function o(e){i.call(this,e),this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay()}var r=n(24),i=n(33);r.inherits(o,i),o.prototype.next_=function(){var e=Math.min(this.nextBackoffDelay_,this.getMaxDelay());return this.nextBackoffDelay_+=this.backoffDelay_,this.backoffDelay_=e,e},o.prototype.reset_=function(){this.nextBackoffDelay_=this.getInitialDelay(),this.backoffDelay_=0},e.exports=o},function(e,t,n){function o(e,t,n){r.EventEmitter.call(this),i.checkIsFunction(e,"Expected fn to be a function."),i.checkIsArray(t,"Expected args to be an array."),i.checkIsFunction(n,"Expected callback to be a function."),this.function_=e,this.arguments_=t,this.callback_=n,this.lastResult_=[],this.numRetries_=0,this.backoff_=null,this.strategy_=null,this.failAfter_=-1,this.retryPredicate_=o.DEFAULT_RETRY_PREDICATE_,this.state_=o.State_.PENDING}var r=n(28),i=n(29),a=n(24),s=n(27),c=n(34);a.inherits(o,r.EventEmitter),o.State_={PENDING:0,RUNNING:1,COMPLETED:2,ABORTED:3},o.DEFAULT_RETRY_PREDICATE_=function(e){return!0},o.prototype.isPending=function(){return this.state_==o.State_.PENDING},o.prototype.isRunning=function(){return this.state_==o.State_.RUNNING},o.prototype.isCompleted=function(){return this.state_==o.State_.COMPLETED},o.prototype.isAborted=function(){return this.state_==o.State_.ABORTED},o.prototype.setStrategy=function(e){return i.checkState(this.isPending(),"FunctionCall in progress."),this.strategy_=e,this},o.prototype.retryIf=function(e){return i.checkState(this.isPending(),"FunctionCall in progress."),this.retryPredicate_=e,this},o.prototype.getLastResult=function(){return this.lastResult_.concat()},o.prototype.getNumRetries=function(){return this.numRetries_},o.prototype.failAfter=function(e){return i.checkState(this.isPending(),"FunctionCall in progress."),this.failAfter_=e,this},o.prototype.abort=function(){this.isCompleted()||this.isAborted()||(this.isRunning()&&this.backoff_.reset(),this.state_=o.State_.ABORTED,this.lastResult_=[new Error("Backoff aborted.")],this.emit("abort"),this.doCallback_())},o.prototype.start=function(e){i.checkState(!this.isAborted(),"FunctionCall is aborted."),i.checkState(this.isPending(),"FunctionCall already started.");var t=this.strategy_||new c;this.backoff_=e?e(t):new s(t),this.backoff_.on("ready",this.doCall_.bind(this,!0)),this.backoff_.on("fail",this.doCallback_.bind(this)),this.backoff_.on("backoff",this.handleBackoff_.bind(this)),this.failAfter_>0&&this.backoff_.failAfter(this.failAfter_),this.state_=o.State_.RUNNING,this.doCall_(!1)},o.prototype.doCall_=function(e){e&&this.numRetries_++;var t=["call"].concat(this.arguments_);r.EventEmitter.prototype.emit.apply(this,t);var n=this.handleFunctionCallback_.bind(this);this.function_.apply(null,this.arguments_.concat(n))},o.prototype.doCallback_=function(){this.callback_.apply(null,this.lastResult_)},o.prototype.handleFunctionCallback_=function(){if(!this.isAborted()){var e=Array.prototype.slice.call(arguments);this.lastResult_=e,r.EventEmitter.prototype.emit.apply(this,["callback"].concat(e));var t=e[0];t&&this.retryPredicate_(t)?this.backoff_.backoff(t):(this.state_=o.State_.COMPLETED,this.doCallback_())}},o.prototype.handleBackoff_=function(e,t,n){this.emit("backoff",e,t,n)},e.exports=o}]);